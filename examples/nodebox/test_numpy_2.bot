import opencv, numpy, cairo
from opencv import highgui as hg
im = hg.cvLoadImage('/home/francesco/build/shoebot/assets/hva_studio_3.jpg')
im2 = opencv.cvCreateImage(opencv.cvGetSize(im),8, 4)
opencv.cvCvtColor(im,im2,opencv.CV_BGR2BGRA)
buffer = numpy.frombuffer(im2.imageData,numpy.uint32)

buffer.shape=(im2.width, im2.height,4)
buffer.flags.writeable=True
print buffer, buffer.shape
imagesurface = cairo.ImageSurface.create_for_data(buffer, cairo.FORMAT_ARGB32, im2.width, im2.height)
imagesurface.write_to_png('test.png')
image(None,0,0,data=imagesurface)